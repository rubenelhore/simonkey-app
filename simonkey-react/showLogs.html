<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notebook Logs Viewer</title>
    <style>
        body {
            font-family: monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #569cd6;
            border-bottom: 2px solid #569cd6;
            padding-bottom: 10px;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
        }
        button:hover {
            background: #005a9e;
        }
        .clear-btn {
            background: #d73a49;
        }
        .clear-btn:hover {
            background: #b31329;
        }
        .log-entry {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            margin: 10px 0;
            padding: 15px;
            border-radius: 4px;
        }
        .log-entry.error {
            border-color: #f14c4c;
            background: #3a1515;
        }
        .log-entry.success {
            border-color: #73c991;
            background: #1a3a1a;
        }
        .timestamp {
            color: #ce9178;
            font-weight: bold;
        }
        .page {
            color: #9cdcfe;
        }
        .action {
            color: #c586c0;
        }
        .error-msg {
            color: #f14c4c;
        }
        .user-type {
            color: #dcdcaa;
        }
        .property {
            color: #9cdcfe;
        }
        .value {
            color: #ce9178;
        }
        .no-logs {
            text-align: center;
            color: #858585;
            padding: 40px;
            font-size: 18px;
        }
        .stats {
            background: #2d2d30;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            display: flex;
            gap: 30px;
        }
        .stat {
            display: flex;
            flex-direction: column;
        }
        .stat-label {
            color: #858585;
            font-size: 12px;
        }
        .stat-value {
            color: #d7ba7d;
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Notebook Logs Viewer</h1>
        
        <div class="controls">
            <button onclick="loadLogs()">üîÑ Refresh Logs</button>
            <button onclick="clearLogs()" class="clear-btn">üóëÔ∏è Clear All Logs</button>
            <button onclick="copyLogs()">üìã Copy to Clipboard</button>
        </div>
        
        <div id="stats" class="stats"></div>
        <div id="logs"></div>
    </div>

    <script>
        function loadLogs() {
            const logsContainer = document.getElementById('logs');
            const statsContainer = document.getElementById('stats');
            const logs = JSON.parse(localStorage.getItem('notebookLogs') || '[]');
            
            if (logs.length === 0) {
                logsContainer.innerHTML = '<div class="no-logs">No logs found. Navigate to a notebook to generate logs.</div>';
                statsContainer.innerHTML = '';
                return;
            }
            
            // Calculate stats
            const errorCount = logs.filter(log => log.error).length;
            const successCount = logs.filter(log => log.action === 'notebook_loaded').length;
            const teacherLogs = logs.filter(log => log.isTeacher === true).length;
            
            statsContainer.innerHTML = `
                <div class="stat">
                    <span class="stat-label">Total Logs</span>
                    <span class="stat-value">${logs.length}</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Errors</span>
                    <span class="stat-value" style="color: #f14c4c">${errorCount}</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Success</span>
                    <span class="stat-value" style="color: #73c991">${successCount}</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Teacher Logs</span>
                    <span class="stat-value">${teacherLogs}</span>
                </div>
            `;
            
            // Display logs in reverse order (newest first)
            logsContainer.innerHTML = logs.reverse().map(log => {
                const isError = !!log.error;
                const isSuccess = log.action === 'notebook_loaded';
                const className = isError ? 'error' : (isSuccess ? 'success' : '');
                
                let html = `<div class="log-entry ${className}">`;
                html += `<div><span class="timestamp">${log.timestamp}</span></div>`;
                
                if (log.page) {
                    html += `<div><span class="property">Page:</span> <span class="page">${log.page}</span></div>`;
                }
                
                if (log.action) {
                    html += `<div><span class="property">Action:</span> <span class="action">${log.action}</span></div>`;
                }
                
                if (log.error) {
                    html += `<div><span class="property">Error:</span> <span class="error-msg">${log.error}</span></div>`;
                    if (log.code) {
                        html += `<div><span class="property">Code:</span> <span class="error-msg">${log.code}</span></div>`;
                    }
                    if (log.message) {
                        html += `<div><span class="property">Message:</span> <span class="error-msg">${log.message}</span></div>`;
                    }
                }
                
                if (log.notebookId) {
                    html += `<div><span class="property">NotebookId:</span> <span class="value">${log.notebookId}</span></div>`;
                }
                
                if (log.notebookName) {
                    html += `<div><span class="property">NotebookName:</span> <span class="value">${log.notebookName}</span></div>`;
                }
                
                if (log.extractedId) {
                    html += `<div><span class="property">ExtractedId:</span> <span class="value">${log.extractedId}</span></div>`;
                }
                
                if (log.decodedName) {
                    html += `<div><span class="property">DecodedName:</span> <span class="value">${log.decodedName}</span></div>`;
                }
                
                if (log.type) {
                    html += `<div><span class="property">Type:</span> <span class="value">${log.type}</span></div>`;
                }
                
                html += `<div class="user-type">`;
                html += `<span class="property">User Type:</span> `;
                if (log.isTeacher) html += '<span style="color: #d7ba7d">Teacher</span> ';
                if (log.isSchoolAdmin) html += '<span style="color: #c586c0">Admin</span> ';
                if (log.isSchoolStudent) html += '<span style="color: #4ec9b0">Student</span> ';
                if (!log.isTeacher && !log.isSchoolAdmin && !log.isSchoolStudent) html += '<span style="color: #858585">Regular</span>';
                html += `</div>`;
                
                if (log.userId) {
                    html += `<div><span class="property">UserId:</span> <span class="value">${log.userId}</span></div>`;
                }
                
                html += `</div>`;
                return html;
            }).join('');
        }
        
        function clearLogs() {
            if (confirm('Are you sure you want to clear all logs?')) {
                localStorage.removeItem('notebookLogs');
                loadLogs();
            }
        }
        
        function copyLogs() {
            const logs = localStorage.getItem('notebookLogs') || '[]';
            navigator.clipboard.writeText(logs).then(() => {
                alert('Logs copied to clipboard!');
            });
        }
        
        // Auto-refresh every 2 seconds
        setInterval(loadLogs, 2000);
        
        // Load logs on page load
        loadLogs();
    </script>
</body>
</html>